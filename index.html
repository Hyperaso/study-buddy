<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Study Buddy</title>
<link rel="manifest" href="manifest.json">
<style>
body{margin:0;font-family:Arial;background:#020617;color:white;display:flex;justify-content:center}
#app{width:390px;min-height:100vh;padding:15px}
h2{color:#22c55e;text-align:center}
input,button{width:100%;padding:12px;border-radius:10px;border:none;margin-top:8px}
button{background:#22c55e;font-weight:bold}

.task{background:#1e293b;padding:12px;border-radius:12px;margin-top:10px}
.task.due{border:2px solid #ef4444}
.task.completed{text-decoration:line-through;color:#94a3b8}
.actions{display:flex;justify-content:space-between;margin-top:8px}
.btn{background:#020617;border:1px solid #334155;color:white;padding:6px 10px;border-radius:8px}

/* GLOBAL BAR */
#globalBox{margin-top:25px}
#globalMsg{text-align:center;margin-bottom:6px;font-size:13px;color:#a5f3fc}
#globalWrap{height:14px;background:#334155;border-radius:12px;overflow:hidden}
#globalBar{height:100%;background:#22c55e;text-align:center;font-size:11px;color:#020617;font-weight:bold}
</style>
</head>

<body>
<div id="app">

<h2>Study Buddy</h2>

<div id="login">
<input id="nameInput" placeholder="Enter your name">
<button onclick="login()">Continue</button>
</div>

<div id="main" style="display:none">

<input id="taskText" placeholder="Task name">
<input id="month" type="number" placeholder="Month">
<input id="day" type="number" placeholder="Day">
<input id="time" type="time">
<button onclick="addTask()">Add Task</button>

<h3>Tasks</h3>
<div id="tasks"></div>

<h3>Finished</h3>
<div id="finished"></div>

<!-- GLOBAL PROGRESS -->
<div id="globalBox">
<div id="globalMsg">Keep it up ‚ú®</div>
<div id="globalWrap"><div id="globalBar">100%</div></div>
</div>

</div>
</div>

<audio id="notifSound" src="ping.mp3"></audio>

<script>
if(!localStorage.reg){
 Notification.requestPermission().then(p=>{if(p=="granted")localStorage.reg=1});
}

const motivations=[
 "üìö One task today is enough.",
 "üî• Start now, thank yourself later.",
 "üöÄ Small progress is still progress.",
 "‚è∞ Your future is waiting.",
 "üí° Discipline beats motivation."
];

let tasks=[];

function notify(msg){
 if(Notification.permission=="granted"){
  new Notification("Study Buddy",{body:msg,icon:"icon.png"});
  notifSound.play().catch(()=>{});
 }
}

/* LOGIN */
function login(){
 if(nameInput.value.trim()) localStorage.user=nameInput.value;
 loginDiv.style.display="none"; main.style.display="block"; load();
}
if(localStorage.user){loginDiv.style.display="none";main.style.display="block";load();}

/* TASK SYSTEM */
function addTask(){
 if(!taskText.value||!month.value||!day.value||!time.value)return;
 let d=new Date(`2026-${month.value.padStart(2,"0")}-${day.value.padStart(2,"0")}T${time.value}:00`).getTime();
 tasks.push({t:taskText.value,deadline:d,done:false,n1:false,n3:false,nd:false});
 save(); render();
}

function save(){localStorage.tasks=JSON.stringify(tasks)}
function load(){tasks=JSON.parse(localStorage.tasks||"[]");render()}

function render(){
 tasksDiv.innerHTML=""; finished.innerHTML="";
 let pending=tasks.filter(t=>!t.done).length;

 tasks.forEach((x,i)=>{
  let div=document.createElement("div");
  div.className="task"+(x.done?" completed":"")+(x.deadline<Date.now()&&!x.done?" due":"");
  div.innerHTML=`<b>${x.t}</b><small>${new Date(x.deadline).toLocaleString()}</small>
  <div class="actions">
   ${!x.done?`<button class="btn" onclick="done(${i})">‚úì</button>`:`<button class="btn" onclick="redo(${i})">‚Ü©</button>`}
   <button class="btn" onclick="del(${i})">‚úñ</button>
  </div>`;
  (x.done?finished:tasksDiv).appendChild(div);
 });

 // GLOBAL BAR
 let total=tasks.length||1;
 let percent=Math.round(((total-pending)/total)*100);
 globalBar.style.width=percent+"%"; globalBar.innerText=percent+"%";

 if(percent==100) globalMsg.innerText="üéâ Well done! No tasks for today.";
 else if(percent>=70) globalMsg.innerText="üî• Keep it up!";
 else if(percent>=40) globalMsg.innerText="‚ö° Do your work!";
 else globalMsg.innerText="‚è∞ You‚Äôre falling behind!";
}

/* ACTIONS */
function done(i){tasks[i].done=true;save();render()}
function redo(i){tasks[i].done=false;save();render()}
function del(i){tasks.splice(i,1);save();render()}

/* DEADLINE CHECK */
function checkTasks(){
 let now=Date.now();
 tasks.forEach(t=>{
  if(t.done)return;
  let diff=t.deadline-now;
  if(diff<86400000 && diff>82800000 && !t.n1){notify("üìÖ Tomorrow: "+t.t);t.n1=true;}
  if(diff<10800000 && diff>10200000 && !t.n3){notify("‚è∞ 3 hours left: "+t.t);t.n3=true;}
  if(diff<0 && !t.nd){notify("‚ö†Ô∏è DUE NOW: "+t.t);t.nd=true;}
 });
 save();
}

/* MOTIVATION EVERY 10 MINS */
function sendMotivation(){
 if(tasks.some(t=>!t.done)){
  notify(motivations[Math.floor(Math.random()*motivations.length)]);
 }
}

setInterval(checkTasks,60000);
setInterval(sendMotivation,600000);
</script>
</body>
</html>
