<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Study Buddy</title>
<link rel="manifest" href="manifest.json">
<style>
body{margin:0;font-family:Arial;background:#0f172a;display:flex;justify-content:center}
#app{width:390px;background:#020617;min-height:100vh;padding:20px;color:white}

.progress-box{margin:15px 0}
.progress-msg{text-align:center;font-size:14px;margin-bottom:5px}
.progress-bar{background:#1e293b;height:16px;border-radius:10px;overflow:hidden}
.progress-fill{background:#22c55e;height:100%;width:0%;transition:.4s}

.task{background:#1e293b;padding:12px;border-radius:12px;margin-top:10px}
.task.completed{text-decoration:line-through;color:#94a3b8}
.task.due{background:#7f1d1d;animation:blink 1s infinite}
@keyframes blink{50%{opacity:.4}}
</style>
</head>
<body>
<div id="app">

<h2>Study Buddy</h2>

<div id="login">
<input id="nameInput" placeholder="Enter your name">
<button onclick="login()">Continue</button>
</div>

<div id="main" style="display:none">

<div class="progress-box">
<div id="progressMsg" class="progress-msg">Add your tasks</div>
<div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
</div>

<input id="taskText" placeholder="Task name">
<input id="date" type="datetime-local">
<button onclick="addTask()">Add Task</button>

<div id="tasks"></div>
<div id="finishedTasks"></div>
</div>

<audio id="notifSound" src="ping.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
<script>
firebase.initializeApp({
 apiKey:"AIzaSyBRsUv_dJVjchdoqUodq95tQ8gUEJyUH_c",
 messagingSenderId:"441262046694",
 appId:"1:441262046694:web:7aede45840e6a636a5aa27"
});
navigator.serviceWorker.register("firebase-messaging-sw.js");

let tasks=JSON.parse(localStorage.tasks||"[]");
Notification.requestPermission();

function login(){
 localStorage.user=nameInput.value;
 login.style.display="none";
 main.style.display="block";
 render();
}

function addTask(){
 const t=taskText.value;
 const d=new Date(date.value).getTime();
 if(!t||!d) return;
 tasks.push({t,deadline:d,done:false,lastOver:0});
 save();
}

function save(){localStorage.tasks=JSON.stringify(tasks);render();}

function render(){
 tasksDiv.innerHTML="";
 let done=tasks.filter(t=>t.done).length;
 let percent=tasks.length?Math.round(done/tasks.length*100):100;
 progressFill.style.width=percent+"%";
 progressMsg.innerText = percent==100?"ðŸŽ‰ Well done! No task for today!":"âš ï¸ You still have tasks to finish";

 tasks.forEach((x,i)=>{
   const div=document.createElement("div");
   const overdue=Date.now()>x.deadline&&!x.done;
   div.className="task"+(x.done?" completed":"")+(overdue?" due":"");
   div.innerHTML=`<input type="checkbox" ${x.done?"checked":""}
   onchange="tasks[${i}].done=!tasks[${i}].done;save()"> ${x.t}`;
   tasksDiv.appendChild(div);
 });
}

function notify(msg){
 new Notification("Study Buddy",{body:msg});
 notifSound.play().catch(()=>{});
}

// overdue alarm every 10 mins
setInterval(()=>{
 tasks.forEach(t=>{
  if(!t.done && Date.now()>t.deadline && Date.now()-t.lastOver>600000){
    notify("âš ï¸ DUE NOW: "+t.t);
    t.lastOver=Date.now(); save();
  }
 });
},600000);

// motivation every 10 mins
const motivation=["ðŸ”¥ Start now","ðŸ“š Small progress","ðŸš€ Do it today","â³ Don't wait"];
setInterval(()=>{ if(tasks.some(t=>!t.done)) notify(motivation[Math.floor(Math.random()*motivation.length)]) },600000);

render();
</script>
</body>
</html>
