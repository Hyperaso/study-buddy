<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Study Buddy</title>
<link rel="manifest" href="manifest.json">
<style>
body {
  margin:0;
  font-family:Arial,sans-serif;
  background:#0f172a;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px 0;
  min-height:100vh;
}

#app {
  width:390px;
  max-width:100%;
  min-height:100vh;
  background:#020617;
  border-radius:20px;
  box-shadow:0 8px 25px rgba(0,0,0,0.3);
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  box-sizing:border-box;
}

h2 {
  text-align:center;
  color:#22c55e;
  margin-bottom:20px;
}

h3 {
  color:#f8fafc;
  margin-top:20px;
  width:100%;
  border-bottom:1px solid #334155;
  padding-bottom:5px;
}

input, button {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:8px;
  font-size:16px;
  box-sizing:border-box;
}

input:focus {
  outline:none;
  border:1px solid #22c55e;
}

button {
  background:#22c55e;
  color:#020617;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}

button:hover {
  background:#16a34a;
}

/* TASK STYLES */
.task {
  background:#1e293b;
  border-radius:12px;
  padding:12px;
  margin-top:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.3);
  width:100%;
  box-sizing:border-box;
  color:#f8fafc;
}

.task.completed {
  text-decoration:line-through;
  color:#94a3b8;
}

/* TASK CONTROLS */
.task-controls{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin-top:10px;
}

.task-left{
 display:flex;
 align-items:center;
 gap:10px;
}

.task-left input[type=checkbox]{
 width:20px;
 height:20px;
 accent-color:#22c55e;
 cursor:pointer;
}

.task-actions{
 display:flex;
 gap:8px;
}

.btn-icon{
 background:#020617;
 border:1px solid #334155;
 color:white;
 padding:6px 10px;
 border-radius:8px;
 font-size:14px;
 cursor:pointer;
 transition:.2s;
}

.btn-icon:hover{
 background:#22c55e;
 color:#020617;
}

.btn-danger:hover{
 background:#ef4444;
 color:white;
}

.btn-secondary:hover{
 background:#3b82f6;
 color:white;
}

.date-inputs {
  display:flex;
  gap:5px;
  margin-top:8px;
  width:100%;
}

.date-inputs input {
  flex:1;
}

.section {
  margin-top:20px;
  width:100%;
}

.section h3 {
  margin-bottom:10px;
  color:#f8fafc;
}

#tasks, #finishedTasks {
  display:flex;
  flex-direction:column;
  width:100%;
}
</style>
</head>
<body>
<div id="app">
<h2>Study Buddy</h2>

<!-- LOGIN -->
<div id="login">
<input id="nameInput" placeholder="Enter your name">
<button onclick="login()">Continue</button>
</div>

<!-- MAIN APP -->
<div id="main" style="display:none; width:100%;">
<h3 id="hi"></h3>
<input id="taskText" placeholder="Task name">
<div class="date-inputs">
<input id="month" type="number" placeholder="Month (1-12)" min="1" max="12">
<input id="day" type="number" placeholder="Day" min="1" max="31">
</div>
<input id="time" type="time">
<button onclick="addTask()">Add Task</button>

<!-- Active Tasks -->
<div class="section">
<h3>Tasks</h3>
<div id="tasks"></div>
</div>

<!-- Finished Tasks -->
<div class="section">
<h3>Finished Tasks</h3>
<div id="finishedTasks"></div>
</div>
</div>
</div>

<audio id="notifSound" src="ping.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

<script>
const firebaseConfig = {
 apiKey: "AIzaSyBRsUv_dJVjchdoqUodq95tQ8gUEJyUH_c",
 authDomain: "study-buddy-1ca03.firebaseapp.com",
 projectId: "study-buddy-1ca03",
 messagingSenderId: "441262046694",
 appId: "1:441262046694:web:7aede45840e6a636a5aa27",
};
firebase.initializeApp(firebaseConfig);
const messaging = firebase.messaging();

// REGISTER ONCE
if(!localStorage.getItem("registered")){
 Notification.requestPermission().then(p=>{
  if(p==="granted") localStorage.setItem("registered","yes");
 });
}
navigator.serviceWorker.register("firebase-messaging-sw.js");

// USER & TASKS
let user="", tasks=[];
const tasksDiv=document.getElementById("tasks");
const finishedTasks=document.getElementById("finishedTasks");

// LOGIN
function login(){
 user=document.getElementById("nameInput").value.trim();
 if(!user) return;
 localStorage.user=user;
 document.getElementById("hi").innerText="Hi "+user+"!";
 document.getElementById("login").style.display="none";
 document.getElementById("main").style.display="block";
 loadTasks();
}

// AUTO LOGIN
if(localStorage.user){user=localStorage.user;login();}

// ADD TASK
function addTask(){
 const t=document.getElementById("taskText").value.trim();
 const m=document.getElementById("month").value;
 const d=document.getElementById("day").value;
 const ti=document.getElementById("time").value;
 if(!t||!m||!d||!ti) return alert("Fill all fields");

 const deadline=new Date(`2026-${m.padStart(2,"0")}-${d.padStart(2,"0")}T${ti}:00`).getTime();
 tasks.push({t,deadline,done:false,notified1:false,notified3:false,notifiedDue:false});
 saveTasks(); renderTasks();
}

// SAVE / LOAD
function saveTasks(){localStorage.tasks=JSON.stringify(tasks);}
function loadTasks(){tasks=JSON.parse(localStorage.tasks||"[]"); renderTasks();}

// TASK CONTROLS
function markDone(i){tasks[i].done=true; saveTasks(); renderTasks();}
function deleteTask(i){tasks.splice(i,1); saveTasks(); renderTasks();}
function editTask(i){
 const t = prompt("Edit task name:", tasks[i].t);
 if(t){
   tasks[i].t = t;
   const m = prompt("Edit month (1-12):", new Date(tasks[i].deadline).getMonth()+1);
   const d = prompt("Edit day:", new Date(tasks[i].deadline).getDate());
   const time = prompt("Edit time (HH:MM):", new Date(tasks[i].deadline).toTimeString().slice(0,5));
   if(m && d && time){
     tasks[i].deadline = new Date(`2026-${m.padStart(2,"0")}-${d.padStart(2,"0")}T${time}:00`).getTime();
   }
   saveTasks(); renderTasks();
 }
}
function redoTask(i){tasks[i].done=false; saveTasks(); renderTasks();}

// RENDER TASKS
function renderTasks(){
 tasksDiv.innerHTML=""; finishedTasks.innerHTML="";
 tasks.forEach((x,i)=>{
  const d=document.createElement("div");
  d.className="task"+(x.done?" completed":"");
  const dt=new Date(x.deadline).toLocaleString();

  if(!x.done){ // Active task
    d.innerHTML = `
    <div class="task-controls">
      <div class="task-left">
        <input type="checkbox" onchange="markDone(${i})">
        <b>${x.t}</b>
      </div>
      <div class="task-actions">
        <button class="btn-icon btn-secondary" onclick="editTask(${i})">‚ãÆ</button>
        <button class="btn-icon btn-danger" onclick="deleteTask(${i})">‚úñ</button>
      </div>
    </div>
    <small>${dt}</small>
    `;
    tasksDiv.appendChild(d);
  } else { // Finished task
    d.innerHTML = `
    <div class="task-controls">
      <b>${x.t}</b>
      <div class="task-actions">
        <button class="btn-icon btn-secondary" onclick="redoTask(${i})">‚Ü©</button>
        <button class="btn-icon btn-danger" onclick="deleteTask(${i})">‚úñ</button>
      </div>
    </div>
    <small>${dt}</small>
    `;
    finishedTasks.appendChild(d);
  }
 });
}

// MOTIVATION LIST
const motivation=[
 "üìò You can do this! Finish one task now.",
 "üî• Small progress is still progress.",
 "‚è≥ Don‚Äôt wait, your future self will thank you.",
 "üöÄ Let‚Äôs go! One task closer to success.",
 "üìö Open your notebook and start now!",
 "üí° 5 minutes of work is better than 0.",
 "üéØ Focus time! Pick one task."
];

// NOTIFY
function notify(msg){
 if(Notification.permission==="granted"){
  new Notification("Study Buddy",{body:msg,icon:"icon.png"});
  notifSound.play().catch(()=>{});
 }
}

// DEADLINE REMINDERS
function checkTasks(){
 const now=Date.now();
 tasks.forEach(t=>{
  if(t.done) return;
  const diff=t.deadline-now;

  if(diff<86400000 && diff>82800000 && !t.notified1){
   notify(`üìÖ Tomorrow: ${t.t}`); t.notified1=true;
  }
  if(diff<10800000 && diff>10200000 && !t.notified3){
   notify(`‚è∞ 3 hours left: ${t.t}`); t.notified3=true;
  }
  if(diff<60000 && diff>-60000 && !t.notifiedDue){
   notify(`‚ö†Ô∏è DUE NOW: ${t.t}`); t.notifiedDue=true;
  }
 });
 saveTasks();
}

// GLOBAL MOTIVATION EVERY 20 MIN
function sendGlobalMotivation(){
 if(tasks.some(t=>!t.done)){
  const msg=motivation[Math.floor(Math.random()*motivation.length)];
  notify(msg);
 }
}

setInterval(checkTasks,60000);       // deadline checker
setInterval(sendGlobalMotivation,1200000); // motivation 20 mins
</script>
</body>
</html>
